# Section 1
## VPC とは
アカウントに紐づく仮装ネットワーク空間

VPCはAZをまたげるが、リージョンはまたげない
- リージョン = 国
- AZ = データセンター


## サブネット
大きなネットワークを複数の小さなネットワークに分割管理
レキュリティレベルを高める
サブネットはAZを跨ぐことができない

サブネットの分割単位は/24がおすすめ

- trusted Internet 内部ネットワークのこと
- untrusted	 Internet 外部ネットワークのこと
この2つはファイアーウォールで隔てられる

### CIDR （サイダー）
- /16 第3、第4オクテットが使える（第1と第2はAWSが内部的に利用するので使えない）

## ルートテーブル
サブネットに関連づけて使用するもので、サブネットから外に出る通信をどこに向けて飛ばすかを決めるルール

- サブネットはルートテーブルを最低でも何か一つは設定しなければならない
- デフォルトからあるルートテーブルは「メインルートテーブル」と呼ぶ
- メインルートテーブルの使用は控える

ルートテーブルは最も明確なルールが優先して適用される
=  最も長い条件にマッチしたルールが適用される
Destination	Taget
10.1.0.0/16	Local
10.1.3.96/32（より明確）	RouteA
RouteA に飛ばされる

# section3

## インターネットゲートウェイ
vpcにアタッチして使用するネットワークコンポーネントで、ec2インスタンスはインターネットに接続可能となる

０.0.0.0 ワイルドカード的なもの

- Elastic IP
インスタンスにアタッチ/デタッチ可能で、静的なインターネットと通信することがきるIPアドレス
インスタンスが再起動、停止、終了した場合も同じIPアドレス

- Public IP
AWSのIPアドレスプールより割り当てられるインターネットと通信することができるIPアドレス

## セキュリティグループ
ec2インスタンス単位で設定を行う仮想ファイアーウォール
拒否ルールを個別に設定できず、許可ルールを設定して累積的に判断
サブネット単位での設定ではないので注意

## ネットワークACL
サブネット単位で設定するファイアーウォール
サブネットに出入りする通信の制御を行う
インスタンス単位ではないことに注意
番号ごとにマッチするか判断し、一度マッチしたらそれ以降は判断しない

#section4

## NATゲートウェイを利用する
ex. セキュリティを保ったままインターネットへ接続したい

プライベートサブネットのインスタンスをインターネットで通信できる

## NAT ゲートウェイとは
- ENI (Elastic Network Interface): VPC内の仮想NICサービス

リージョンサービス
インターネットの接続を必要とするサービス

- vpcエンドポイント
リージョンサービスをプライベートな通信で利用できる

# section5 
## vpcエンドポイント
インターネット経由せずにプライベートな通信で接続できる機能
プリフェックスリストIDが設定される

### プリフェックスリストID (prefex)とは
AWSのサービスが使用するパブリックIPアドレスレンジを示すもので、pl-xxxxxxxなどのID形式のこと

### Gateway型
- S3, DynamoDB
- ルートテーブルに設定
- 安価

### Interface型
- 実体はENI
- 対象サービスは24種類くらい
    - ex. ECS
- セキュリティグループをアタッチして使用
- 時間課金＆転送量課金

Private Link

## vpcエンドポイントサービス
VPC内のUMI からPrivate Link を利用してサービス提供者のvpcエンドポイントに接続して、サービス提供者のサービスを利用する

# section 6
## Direct conne
- 「専用線サービス」
- データセンターの物理サーバーと大量のデータをやり取りする場合にデータ転送料金を安くできる

AWS Direct Connection パートナー契約を結びdirect connectロケーション（ex. エクイニクス
）に接続 
ex. 自宅にインターネット回線を引き込む時みたいな流れ（インターネット- 基地局- 自宅）

### 仮想インターフェース
Direct connect を使用するために作成するネットワーク的な部品のこと

- プライベートVIFs
- パブリックVIFs

### Direct Connect Gateway
一つのプライベートVIFsで複数のvpcに接続できますが、同一のAWSアカウントでなければならないので注意

中国リージョンのvpcには接続できない

### Transit Gateway
vpx同士の接続を単一のハブで管理できるサービスのこと

- トランジットVIFs
Direct Connect でトランジットゲートウェイに接続するためのVIFs
先ほどのDirect Connect Gateway と合わせて使用される

## vpcピアリング
他のvpcに接続するときにvpcピアリングを使用
これによって異なるvpcに配置されたec2インスタンス同士が、あたかも同一のネットワークにいるかのように接続できるようになります

### vpcピアリングの開始
- VPC-Bの所有者に接続リクエストを送る
    1. 同一アカウントならvps-IDで識別される
    2. 別アカウントならアカウントID且つvpc-IDで識別される
- 接続リクエストが承認されるとルートテーブルにPCX-xxxxxのID形式でルーテクングが設定されることにより接続可能となる

### サポートされてないvpcピア接続設定
- vpcピアリングはCIDRが重複していると接続できない




